if (self.CavalryLogger) { CavalryLogger.start_js(["xlOh9"]); }

__d("FantaReducersSendMessages",["fbt","AsyncRequest","Bootloader","ChatTabViewEvents","CurrentUser","EmojiLikeUtils","EmojiState","FantaMessageActions","FantaTypeComposer","FantaTypeFileUploader","FantaTypeTabContents","MercuryIDs","MercuryIgnoredBlockedParticipants.bs","MercuryLogMessageType","MercuryMessageActions","MercuryMessageObject","MessengerParticipants.bs","MercurySheetPolicy","MercurySourceType","MercuryThreadActions","MercuryThreadIDMap","MercuryThreadInfo","MessageRequestUtils","MessengerAdminGroupUtils","MessengerApprovalModeTypes","MessengerDiscoveryEntryPoint","MessengerDiscoveryEntryPointsLoggingHelper","MessengerEmojiUsageUtils","RepliedToMessageStatusForGraphQL","MessengerState.bs","MessengerUploadFilesUtil.bs","SimpleXUIDialog","SiteData","XMessagingSetThreadNameController","getPageIDFromThreadID","gkx"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("MercuryMessageActions").get(),i=b("MercuryMessageObject").get(),j=b("MercuryThreadActions").get(),k=b("MercuryThreadIDMap").get(),l=b("FantaMessageActions").Types,m=/^\s*$/,n="/ajax/chat/multichat/name_conversation/dismiss.php";function a(a,c){__p&&__p();switch(c.type){case l.UPDATE_GROUP_NAME:var d=c.threadID;c=c.newName;var e=a.mercury.tabContents.get(d);if(!e)return a;var f=e;f=f.thread;if(!f)return a;f=f.name;(c||f)&&c!==f&&z(d,c);k.getServerIDFromClientID(d,function(a){new(b("AsyncRequest"))(n).setData({thread_fbid:a}).send()});e=e.merge({openSheet:null});a=a.setIn(["mercury","tabContents",d],e)}return a}function c(a,b){switch(b.type){case l.SET_NEW_GROUP_NAME_LOCALLY:var c=b.threadID;b=b.newName;var d=a.mercury.tabContents.get(c);if(!d)return a;d=d.merge({newGroupChatName:b});a=a.setIn(["mercury","tabContents",c],d)}return a}function d(a,b){switch(b.type){case l.ADD_GROUP_PARTICIPANTS_AS_OPEN_TAB:case l.ADD_GROUP_PARTICIPANTS_AS_REPLACE_TAB:b=b.tabID;var c=a.mercury.tabContents.get(b);if(!c)return a;c=c.merge({typeahead:null});a=a.setIn(["mercury","tabContents",b],c)}return a}function f(a,c){__p&&__p();switch(c.type){case l.ADD_GROUP_PARTICIPANTS:var d=c.threadID,e=a.mercury.tabContents.get(d),f=e,j=f.thread;f=f.typeahead;if(!f||!j)return a;f=f.getSelectedParticipantIDs();var k=b("MessengerAdminGroupUtils").shouldInvite(j);k?f.forEach(function(a){a=b("MercuryIDs").getThreadIDFromParticipantID(a);a&&h.send(i.constructUserGeneratedMessageObject(j.joinable_mode.link,b("MercurySourceType").CHAT_WEB,a))}):h.send(i.constructLogMessageObject(b("MercurySourceType").CHAT_WEB,d,b("MercuryLogMessageType").SUBSCRIBE,{added_participants:f}));k=j.admins[b("CurrentUser").getID()]!==void 0;if(j.approval_mode===b("MessengerApprovalModeTypes").APPROVALS&&!k){d=g._("New members need to be approved by an admin. This request was added to the approval queue.");f=g._("Approval pending");b("SimpleXUIDialog").show(d,f)}k=c.threadID;e=e.merge({typeahead:null});a=a.setIn(["mercury","tabContents",k],e)}return a}function o(a){__p&&__p();a=a&&a.entryPoint;Array.isArray(a)&&(a=a[0]);switch(a){case"compose_link":a="chat_sidebar_new_message";break;case"jewel_new_message":a="jewel_new_message";break;case"created_locally_from_tokens":a="one_to_one_plus";break}return a}function p(a,c){if(!c)return[];a=b("getPageIDFromThreadID")(a);var d=[];a!==null&&Object.values(b("MessengerDiscoveryEntryPoint")).indexOf(c)!==-1&&d.push(b("MessengerDiscoveryEntryPointsLoggingHelper").getEntryPointsLoggingTagStr([c]));d.push("web:trigger:"+c);return d}function q(a){var c=a&&a.is_canonical&&!b("MercuryThreadInfo").canReply(a);if(c&&a){B(a);return!0}return!1}function r(a,c,d){var e=b("MessengerState.bs").isEmptyLocalThread(b("CurrentUser").getID(),a);if(e&&c&&c.size>1){var f=b("MercuryIDs").tokenize(a).value;b("Bootloader").loadModules(["MessengerWebChatEventsTypedLogger","MessengerWebChatEventType"],function(a,b){new a().setEvent(b.CLICK_NEW_MESSAGE).setOfflineThreadingID(f).setEntryPoint(d).log()},"FantaReducersSendMessages")}}function s(a,c,d){__p&&__p();var e=a.mercury.tabContents.get(c);if(!e)return a;if(c!==d){var f=a.tabGroup.tabs.get(c);a=a.deleteIn(["tabGroup","tabs",c]);a=a.deleteIn(["mercury","tabContents",c]);a=a.setIn(["tabGroup","tabs",d],f.merge({id:d}));a=a.setIn(["mercury","tabContents",d],new(b("FantaTypeTabContents"))({composer:e.composer,id:d}))}else a=a.setIn(["mercury","tabContents",d],e.merge({isNewMessageTab:!1,openSheet:null}));return a}function t(a,c,d){d&&(z(c,d),b("Bootloader").loadModules(["WorkChatActivityTypedLogger","WorkChatActivityEvent"],function(a,b){new a().setEvent(b.NAMED_GROUP_CHAT_CREATION_FROM_CHAT_TAB).log()},"FantaReducersSendMessages"),a=a.setIn(["mercury","tabContents",c],a.mercury.tabContents.get(c).merge({newGroupChatName:null})));return a}function u(a,c,d,e,f,g,k){var l=i.constructHotLikeObject(a,b("MercurySourceType").CHAT_WEB,c,p(c,d),e);h.send(function(){b("EmojiLikeUtils").setEmojiSize(l,f||"");return b("EmojiLikeUtils").setEmojiSource(l,g||"")}());k&&k(l);j.markRead(c);j.markSeen(c)}function v(a,c){__p&&__p();switch(c.type){case l.SEND_HOT_LIKE:if(!b("gkx")("800690"))return a;var d=c.emoji,e=c.onSendSuccess,f=c.size,g=c.source;c=c.threadID;var h=a.mercury.tabContents.get(c);if(!h)return a;var i=o(a.tabGroup.tabs.get(c)),j=h.signatureID,k=h.threadPreviewID,m=h.threadPreviewRecipients,n=h.newGroupChatName;k=k||c;h=h.thread;if(!q(h)){h=b("MessengerEmojiUsageUtils").findAllEmojis(d);h.length>0&&b("EmojiState").updateRecentlyUsed(h);u(d,c,i,j,f,g,e);a=s(a,c,k);a=t(a,c,n);r(k,m,i)}}return a}function w(a,c){__p&&__p();switch(c.type){case l.SEND_STICKER:if(!b("gkx")("802754"))return a;var d=c.threadID,e=a.tabGroup.tabs.get(d),f=c.onSendSuccess;c=c.stickerID;var g=a.mercury.tabContents.get(d);if(!g)return a;var h=g.signatureID,i=g.threadPreviewID,j=g.threadPreviewRecipients,k=g.newGroupChatName;i=i||d;g=g.thread;q(g)||(x(i,c,j,h,o(e),f),a=s(a,d,i),a=t(a,d,k),r(i,j,o(e)))}return a}function x(a,c,d,e,f,g){c=i.constructStickerMessageObject(c,b("MercurySourceType").CHAT_WEB,a,p(a,f),e);D(c,a,d);g&&g(c);j.markRead(a);j.markSeen(a)}function y(a,c){__p&&__p();switch(c.type){case l.SEND_HOT_LIKE:case l.SEND_MESSAGE:case l.SEND_PHOTO:case l.SEND_STICKER:if(c.type===l.SEND_HOT_LIKE&&b("gkx")("800690")||c.type===l.SEND_STICKER&&b("gkx")("802754"))return a;var d=c.message,e=c.threadID,f=d?d.mentions:null;d&&(d=d.message);var g=a.tabGroup.tabs.get(e),h=g&&g.entryPoint||null;Array.isArray(h)&&(h=h[0]);switch(h){case"compose_link":h="chat_sidebar_new_message";break;case"jewel_new_message":h="jewel_new_message";break;case"created_locally_from_tokens":h="one_to_one_plus";break}g=c.emoji;var i=c.onSendSuccess,j=c.photoData,k=c.size,n=c.source,o=c.stickerID,p=c.composer,q=a.mercury.tabContents.get(e);if(!q)return a;var r=q,s=r.composer,t=r.signatureID,u=r.threadPreviewID,v=r.threadPreviewRecipients;r=r.newGroupChatName;var w=s.fileUploader,x=s.sharePreview,y=s.replyingToMessage;y=y;if(p&&s&&p.version!==s.version)return a;p=u||e;s=q.thread;var D=!!(!d&&g&&k),E=!!(!d&&o),F=b("MessengerState.bs").isEmptyLocalThread(b("CurrentUser").getID(),p);D?d=g:(E||j)&&(d="");g=s&&s.is_canonical&&!b("MercuryThreadInfo").canReply(s);var G=!!(x.params&&x.type);if(A(w,x))q=q.merge({openSheet:b("MercurySheetPolicy").sheets.ChatUploadWarningTabSheet}),a=a.setIn(["mercury","tabContents",e],q);else if(g&&s)B(s);else if(!m.test(d)||w.uploadedFiles.size>0||G||E||j){g=b("MessengerEmojiUsageUtils").findAllEmojis(d);g.length>0&&b("EmojiState").updateRecentlyUsed(g);s=E?[]:w.getTypeIDs(b("FantaTypeFileUploader").fileTypes.GENERIC_ATTACHMENT);G=C(p,d,s,x,D,w,k,n,E,o,j,v,f,t,h,y);g=u&&c.type===l.SEND_MESSAGE&&w.get("uploadedFiles").size>0;if(G){if(e!==p){if(!g){d=a.tabGroup.tabs.get(e);a=a.deleteIn(["tabGroup","tabs",e]);a=a.deleteIn(["mercury","tabContents",e]);a=a.setIn(["tabGroup","tabs",p],d.merge({id:p}));q=new(b("FantaTypeTabContents"))({composer:q.composer,id:p});a=a.setIn(["mercury","tabContents",p],q)}}else q=q.merge({isNewMessageTab:!1}),a=a.setIn(["mercury","tabContents",p],q);k=y||!D&&!E&&!j||j&&!((s=j)!=null?(s=s.preview_attachments)!=null?(s=s[0])!=null?s.preview_url:s:s:s);n=g?e:p;a.mercury.tabContents.get(n)&&k&&(q=q.merge({composer:new(b("FantaTypeComposer"))()}),a=a.setIn(["mercury","tabContents",n],q))}G&&i&&i(G);r&&(z(e,r),b("Bootloader").loadModules(["WorkChatActivityTypedLogger","WorkChatActivityEvent"],function(a,b){new a().setEvent(b.NAMED_GROUP_CHAT_CREATION_FROM_CHAT_TAB).log()},"FantaReducersSendMessages"),q=q.merge({newGroupChatName:null}),a=a.setIn(["mercury","tabContents",e],q))}A(w,x)||(q=q.merge({openSheet:null}),a=a.setIn(["mercury","tabContents",p],q));if(F&&v&&v.size>1){var H=b("MercuryIDs").tokenize(p).value;b("Bootloader").loadModules(["MessengerWebChatEventsTypedLogger","MessengerWebChatEventType"],function(a,b){new a().setEvent(b.CLICK_NEW_MESSAGE).setOfflineThreadingID(H).setEntryPoint(h).log()},"FantaReducersSendMessages")}return a}return a}function z(a,c){c&&k.getServerIDFromClientID(a,function(a){var d=b("XMessagingSetThreadNameController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(d).setData({thread_id:a,thread_name:c}).send()})}function A(a,b){return!!(a.uploadingFiles.size>0)}function B(a){var c=a.thread_id,d=b("MercuryIDs").getParticipantIDFromFromThreadID(c);if(d&&a){var e=b("CurrentUser").getID();b("MessengerParticipants.bs").get(d,function(d){b("Bootloader").loadModules(["MessageBlockedDialog"],function(f){b("MessengerState.bs").compute(e,function(g){g=g.blocked_ids;f.show(c,a.can_reply,b("MercuryIgnoredBlockedParticipants.bs").qualifiesAs(e,g,a),d.short_name)})},"FantaReducersSendMessages")})}}function C(a,c,d,e,f,g,k,l,m,n,o,p,q,r,s,t){__p&&__p();l||(l=b("MercurySourceType").CHAT_WEB);var u=i.constructUserGeneratedMessageObject(c,b("MercurySourceType").CHAT_WEB,a);if(s){var v=b("getPageIDFromThreadID")(a);v!==null&&Object.values(b("MessengerDiscoveryEntryPoint")).indexOf(s)!==-1&&u.tags.push(b("MessengerDiscoveryEntryPointsLoggingHelper").getEntryPointsLoggingTagStr([s]));u.tags.push("web:trigger:"+s)}d.length>0&&(u.has_attachment=!0,u.raw_attachments=d);t&&(u.replied_to_message={message:t,status:b("RepliedToMessageStatusForGraphQL").VALID});q&&q.length&&(u.profile_ranges=u.profile_xmd=q);m&&(u.has_attachment=!0,u.sticker_id=n);if(!m&&!f&&e.params&&e.type){v={share_params:e.params.get("data"),share_type:e.type};v&&(u.has_attachment=!0,u.shareable_attachment=v)}u.signatureID=r;u.ui_push_phase=b("SiteData").push_phase;!m&&o?h.addAttachmentPlaceholder(u,o.upload_id,o):!f?((c||u.has_attachment)&&D(u,a,p),m||E(g,a,p,t)):k&&l&&(u.has_attachment=!1,h.send(function(){b("EmojiLikeUtils").setEmojiSize(u,k||"");return b("EmojiLikeUtils").setEmojiSource(u,l||"")}()));j.markRead(a);j.markSeen(a);return u}function D(a,c,d){__p&&__p();var e=b("CurrentUser").getID();if(b("MessengerState.bs").isEmptyLocalThread(e,c)){d&&j.addParticipants(c,d.toArray());a.offline_threading_id=b("MercuryIDs").tokenize(c).value;d=b("MessengerState.bs").getThreadMetaNow(e,c);d&&(a.specific_to_list=Array.from(d.participants))}h.send(a,function(a){var c=b("MessengerState.bs").getThreadMetaNow(e,a);c&&b("MessageRequestUtils").isMessageRequest(c)&&j.movePendingToInbox(a);c&&c.thread_id&&c.other_user_fbid&&b("getPageIDFromThreadID")(c.thread_id)&&b("ChatTabViewEvents").inform("chat-send-to-page",{pageID:c.other_user_fbid})})}function E(a,c,d,e){__p&&__p();if(a.uploadedFiles.size===0)return;var f=b("MessengerUploadFilesUtil.bs").supportAttachments;for(var g in f){var h=b("MessengerUploadFilesUtil.bs").getAttachmentIDs(a,g);if(Array.isArray(h)){var j=i.constructAttachmentMessageObject(b("MercurySourceType").CHAT_WEB,c);j[f[g]]=h;e?D(babelHelpers["extends"]({},j,{replied_to_message:{message:e,status:b("RepliedToMessageStatusForGraphQL").VALID}}),c,d):D(j,c,d)}}}e.exports={addParticipantToLocalGroup:d,sendGroupMessage:f,sendHotLike:v,sendMessage:y,sendSticker:w,setNewGroupNameLocally:c,updateGroupName:a}}),null);
__d("SphericalPhotoManagerLoader",["SphericalPhotoManager"],(function(a,b,c,d,e,f){"use strict";e.exports=b("SphericalPhotoManager").module}),null);