if (self.CavalryLogger) { CavalryLogger.start_js(["s\/QoI"]); }

__d("FBRTCCallabilityStore",["FBRTCDispatcher","RTCCallabilityStore"],(function(a,b,c,d,e,f){"use strict";e.exports=new(b("RTCCallabilityStore"))(b("FBRTCDispatcher"))}),null);
__d("ChatVideoCallButton.react",["cx","fbt","invariant","Bootloader","ChatConfig","ChatVideoCallIcon.bs","CurrentUser","FantaAvailableStatus","FBIDCheck","FBRTCCallabilityStore","FBRTCCore","ImmutableObject","Keys","LayerFadeOnHide","Link.react","MercuryIDs","MessengerParticipants.bs","RTWebLoggingCallType","RTWebLoggingSurface","RTWebUserActionLogger","VideoCallWebDriverIDs","immutable","MercuryThreadIDMap","React","RTCCallState","TrackingNodes","FBRTCLogger","XUIAmbientNUX.react"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k=b("ChatVideoCallIcon.bs").jsComponent,l=b("MercuryThreadIDMap").get(),m=b("FBRTCLogger").Trigger,n=b("ChatConfig").get("chat_tab_m4_header");c=babelHelpers.inherits(a,b("React").PureComponent);j=c&&c.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=j.constructor).call.apply(a,[this].concat(e)),this.$1=null,this.$2=null,this.state={isCallable:!1,user:null},this.$6=function(a){a.preventDefault(),this.$8()}.bind(this),this.$7=function(a){a.preventDefault();if(a.keyCode!==b("Keys").RETURN)return;a.target&&(a.target instanceof HTMLElement||i(0,5852),a.target.blur());this.$8()}.bind(this),c}a.prototype.componentDidMount=function(){var a=this.props,c=a.isAudio;a=a.isGroupChat;a=[b("RTWebUserActionLogger").getCallType(a),b("RTWebUserActionLogger").getAudioVideoComponent(c)];c=a[0];a=a[1];b("RTWebUserActionLogger").logPreCallImpression({callType:c,surface:b("RTWebLoggingSurface").CHAT_TAB,component:a});this.setState({isCallable:this.$3(),user:this.$4()});this.$2=b("FBRTCCallabilityStore").addListener(function(a){this.setState({isCallable:this.$3(),user:this.$4()})}.bind(this))};a.prototype.componentDidUpdate=function(){if(!this.$1){var a=this.$5();this.state.user&&this.state.user.id!==a&&this.setState({user:this.$4()})}a=this.$3();a!==this.state.isCallable&&this.setState({isCallable:a})};a.prototype.componentWillUnmount=function(){this.$1&&b("MessengerParticipants.bs").removeCallback(this.$1),this.$2&&this.$2.remove()};a.prototype.$5=function(){var a=b("MercuryIDs").getUserIDFromThreadID(this.props.threadID);if(a===this.props.viewer||!b("FBIDCheck").isUser_deprecated(a))return null;a&&b("FBIDCheck").isUser_deprecated(a)||i(0,5851);return b("MercuryIDs").getParticipantIDFromUserID(a)};a.prototype.$4=function(){var a=this.$5(),c=null;if(a){var d=b("MessengerParticipants.bs").getNow(a);this.$1&&b("MessengerParticipants.bs").removeCallback(this.$1);d?(this.$1=null,c=d):this.$1=b("MessengerParticipants.bs").getMulti([a],function(b){this.$1=null,this.setState({user:b[a]})}.bind(this))}return c};a.prototype.$3=function(){if(!this.props.threadID)return!1;if(this.props.isGroupChat)return!0;var a=b("MercuryIDs").getUserIDFromThreadID(this.props.threadID);if(a===this.props.viewer||!b("FBIDCheck").isUser_deprecated(a))return!1;a&&b("FBIDCheck").isUser_deprecated(a)||i(0,5851);return!b("FBRTCCallabilityStore").isBlocked(a,this.props.thread)&&b("FBRTCCallabilityStore").isCallable(a,this.props.thread)};a.prototype.getTooltipLabel=function(){if(this.props.isGroupChat)return this.props.isAudio?h._("Start a group call"):h._("Start a group video chat");var a=this.state.user;return!a||!a.fbid?void 0:this.props.isAudio?b("FBRTCCallabilityStore").voiceCallButtonTooltip(a.fbid,a.short_name,this.state.isCallable,this.props.thread):b("FBRTCCallabilityStore").callButtonTooltip(a.fbid,a.short_name,this.state.isCallable,this.props.thread)};a.prototype.render=function(){if(!this.props.shown||n&&!this.state.isCallable)return null;var a=b("TrackingNodes").getTrackingInfo(this.props.isAudio?b("TrackingNodes").types.VIDEOCHAT:b("TrackingNodes").types.VOICECHAT),c=JSON.stringify({videochat:"call_clicked_bhat_tab"}),d=this.props.threadID&&b("FantaAvailableStatus").isAvailable(this.props.thread,this.props.threadID);d=d&&this.state.isCallable;return b("React").createElement("div",null,b("React").createElement(b("Link.react"),{"aria-label":this.getTooltipLabel(),className:"button _3olv"+(!n&&this.props.isAudio?" _2fpc":"")+(!n&&!this.props.isAudio?" _2fpd":"")+(this.state.isCallable?" enabled":""),"data-ft":a,"data-gt":c,"data-hover":"tooltip","data-tooltip-content":this.getTooltipLabel(),"data-tooltip-position":"above","data-testID":this.props.isAudio?b("VideoCallWebDriverIDs").START_VOICE_CALL:b("VideoCallWebDriverIDs").START_VIDEO_CALL,onClick:this.$6,onKeyUp:this.$7,ref:"button"},n?b("React").createElement(k,{isAudio:this.props.isAudio,iconStyle:this.props.iconStyle}):null),b("React").createElement("div",{className:d&&!this.props.isAudio?"_18pe":""}),b("React").createElement(b("XUIAmbientNUX.react"),{alignment:"right",behaviors:{LayerFadeOnHide:b("LayerFadeOnHide")},contextRef:function(){return this.refs.button}.bind(this),onCloseButtonClick:this.props.onRTCNuxCloseButtonClick,shown:this.props.rtcNuxShown,width:"auto"},h._("You can now make a group call.")))};a.prototype.$8=function(){if(!this.state.isCallable)return;this.props.onRTCNuxCloseButtonClick();this.$9()};a.prototype.$9=function(){__p&&__p();var a=this.props,c=a.isAudio,d=a.isGroupChat;a=a.threadID;!a&&i(0,5853);if(d){d=b("RTWebUserActionLogger").getAudioVideoComponent(c);b("RTWebUserActionLogger").logPreCallClick({callType:b("RTWebLoggingCallType").MW,surface:b("RTWebLoggingSurface").CHAT_TAB,component:d});b("MercuryIDs").isLocalThread(a)?l.getServerIDFromClientID(a,function(a){return this.$10(a)}.bind(this)):this.$10(b("MercuryIDs").getThreadFBIDFromThreadID(a))}else{d=this.state.user&&this.state.user.fbid;if(!d)return;a=c?"chattab_audio_button":"chattab_video_button";b("FBRTCCore").startOutgoingCall(d,a,!!c)}};a.prototype.$10=function(a){__p&&__p();var c=this.props,d=c.isAudio;c=c.rtcCallData;c=c?c:{};var e=c.call_state;c=c.server_info_data;if(e!=="NO_ONGOING_CALL"&&c){b("FBRTCCore").startGroupCall({conferenceName:"GROUP:"+a,hasVideo:!d,serverInfoData:c,trigger:e!==b("RTCCallState").AUDIO_GROUP_CALL?d?m.MULTIWAY_THREAD_HEADER_JOIN_AUDIO_CALL_AUDIO_BUTTON:m.MULTIWAY_THREAD_HEADER_JOIN_AUDIO_CALL_VIDEO_BUTTON:d?m.MULTIWAY_THREAD_HEADER_JOIN_VIDEO_CALL_AUDIO_BUTTON:m.MULTIWAY_THREAD_HEADER_JOIN_VIDEO_CALL_VIDEO_BUTTON});return}b("Bootloader").loadModules(["FBRTCSupport","MessengerState.bs","MessengerParticipantsFetcher.bs","FBRTCUnsupportedBrowserMessage","MessengerRTCGroupCallParticipantsPickerDialogController"],function(c,e,f,g,h){__p&&__p();if(!c.isGroupCallWebtrcSupported()){g.showForOutgoingGroupCall();return}e.getThreadMeta(b("CurrentUser").getID(),this.props.threadID,function(c){var e=c.participants?c.participants.filter(function(a){return a!==b("MercuryIDs").getParticipantIDFromUserID(this.props.viewer)}.bind(this)).map(function(a){return b("MercuryIDs").getUserIDFromParticipantID(a)}):[];e.length>0?f.fetch({ids:e}).done(function(d){h.render({participants:b("immutable").Map(d.map(function(a){return[a.id,new(b("ImmutableObject"))(a)]})),thread:c,viewerID:this.props.viewer,trigger:this.props.isAudio?m.MULTIWAY_THREAD_HEADER_AUDIO_BUTTON:m.MULTIWAY_THREAD_HEADER_VIDEO_BUTTON,conferenceName:"GROUP:"+a,hasVideo:!this.props.isAudio})}.bind(this)):b("FBRTCCore").startGroupCall({conferenceName:"GROUP:"+a,hasVideo:!d,trigger:d?m.MULTIWAY_THREAD_HEADER_AUDIO_BUTTON:m.MULTIWAY_THREAD_HEADER_VIDEO_BUTTON})}.bind(this))}.bind(this),"ChatVideoCallButton.react")};a.defaultProps={shown:!0,rtcCallData:{call_state:"NO_ONGOING_CALL"}};e.exports=a}),null);